var app=angular.module("CucumberFancyReport",["ui.bootstrap","ngSanitize"]);app.controller("ReportCtrl",["$scope","$filter","$http",function(a,b,c){var d={columns:[{name:"name",display:"ツ",main:!0},{name:"total",display:"Total Σ"},{name:"passed",display:"Passed ☼"},{name:"failed",display:"Failed ☁"},{name:"skipped",display:"Skipped ♒"},{name:"duration",display:"Duration(ms) ⌛"}]};a.selectFeature=function(b){b.parent||(b.isSelected=!0,a.selectedFeature=b.payload,a.isFeatureSelected=!0)},a.deselectFeature=function(){a.isFeatureSelected=!1},a.getColumns=function(){return a.isFeatureSelected?d.columns.filter(function(a){return a.main}):d.columns},a.reflectFeatureStatus=function(a){if(a.parent)return"";var b="passed";return a.failed?b="failed":a.skipped&&(b="skipped"),b+=" pointer"},a.toggleStep=function(a,b){var c=a[b].isOpen;0==b?a.forEach(function(a){a.isOpen=!c}):a[b].isOpen=!c},a.storage={features:[]},a.getScenariosPointers=function(b){if(!a.isFeatureSelected)return[];var c=[];return b.forEach(function(a,b){"scenario_outline"==a.type&&c.push(b)}),c};var e=function(a,b){var c=0,d=0,e=0,f=0,g=b.length;b.forEach(function(a){var b=a.result;c+=b.duration||0,"passed"==b.status?e++:"failed"==b.status?d++:("undefined"==b.status||"skipped"==b.status)&&f++}),this.toJson={name:a,duration:c,passed:e,failed:d,skipped:f,total:g}},f=function(a,b){var c=0,d=0,e=0,f=0,g=0,h="root",i=a.uri;!function(a){var b=a.split("/");b.length>1?(h=b[b.length-2],i=b[b.length-1]):(h="root",i=a)}(a.uri),b.forEach(function(a){c+=a.total,d+=a.passed,e+=a.failed,f+=a.skipped,g+=a.duration});var j=function(a){if(!a.elements||!a.elements.length)return[];for(var b=a.elements,c=[],d=0,e=b.length;e>d;d++)if("scenario_outline"==b[d].type){for(var f=b[d],g=f.examples[0].rows,h=1,i=g.length;i>h;h++)g[h].scenario=b[d+h];c.push(f),d+=g.length-1}else c.push(b[d]);return c};a.scenarios=j(a),this.toJson={name:a.name,duration:parseFloat(g/1e6).toFixed(2),passed:d,failed:e,skipped:f,total:c,payload:a}};c.get("pretty-json.json").success(function(b){var c={};c.children=[],b.map(function(a){var b=function(a,b){for(var d=a.split("/"),e=c,f=0;f<d.length-1;f++)e[d[f]]||(e[d[f]]={},e[d[f]].children=[],e[d[f]].details={total:0,failed:0,passed:0,skipped:0,duration:0}),e=e[d[f]],e.details={total:e.details.total+b.total,passed:e.details.passed+b.passed,failed:e.details.failed+b.failed,skipped:e.details.skipped+b.skipped,duration:e.details.duration+parseFloat(b.duration)};e.children.push(b)},d=[];a.elements&&a.elements.length&&a.elements.map(function(a){"scenario"==a.type&&d.push(new e(a.name,a.steps).toJson)});var g=new f(a,d).toJson;b(a.uri,g)});var d=[],g=function(a,b){var c=function(a,b,c){return{name:b,level:c,parent:!0,total:a.total,passed:a.passed,failed:a.failed,skipped:a.skipped,duration:parseFloat(a.duration).toFixed(2)}};for(var e in a)a.hasOwnProperty(e)&&"children"!=e&&"details"!=e&&(d.push(c(a[e].details,e,b)),g(a[e],b+1));var f=a.children||[];d=d.concat(f.map(function(a){return a.level=b+1,a}))};g(c,0),a.storage.features=d}).error(function(b,c){alert("Source JSON file not found."),console.log(b),console.log(c),a.storage.features=[]})}]),app.filter("highlightPlaceholder",function(){return function(a){return a.replace(/<(.*?)>/gim,function(a){return"<span class='placeholder'>"+a.replace(/>/g,"&gt;").replace(/</g,"&lt;")+"</span>"})}}),app.filter("highlightStepPlaceholder",function(){return function(a){var b=a.name;if(a.match&&a.match.arguments)for(var c=a.match.arguments.length-1;c>=0;c--){var d=a.match.arguments[c],e="<span class='placeholder'>"+d.val+"</span>";b=b.substring(0,d.offset)+e+b.substring(d.offset+d.val.length)}return b}}),app.filter("capitalize",function(){return function(a){function b(a){return a.charAt(0).toUpperCase()+a.substring(1)}var c=a.match(/[A-Za-z][a-z]*/g);return c.map(b).join(" ")}});